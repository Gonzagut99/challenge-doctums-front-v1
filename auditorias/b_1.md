# Archivo para mapeo de bugs v0.1

## Bug Carga de partida
- Error al crear una partida
- Lado del cliente
- Manejo incorrecto de useState

## Bug carga de canvas
- Cuando el host quiere iniciar una partida, esta no renderiza el canvas del mapa del juego.
- (Hipótesis) no hay hipótesis del por qué de este comportamiento.

## Bug en la emisión de eventos
- (Hipótesis) esto podría estar relacionado con el tema de que las conexiones websocket se están cerrando por tiempo de inactividad, posiblemente debamos revisar lógica del back, pero.
``` json
Log de error
TypeError: Cannot read properties of undefined (reading 'emit')
    at _layout (eval at instantiateModule (file:///C:/Users/Lenovo/Documents/CERTUS%20VI/Exp%20Formativas/challenge-doctums-front-v1/node_modules/vite/dist/node/chunks/dep-BWSbWtLw.js:52963:24), <anonymous>:175:34)
    at renderWithHooks (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:5724:16)
    at renderIndeterminateComponent (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:5798:15)
    at renderElement (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6023:7)
    at renderNodeDestructiveImpl (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6181:11)
    at renderNodeDestructive (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6153:14)
    at renderContextProvider (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:5997:3)
    at renderElement (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6094:11)
    at renderNodeDestructiveImpl (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6181:11)
    at renderNodeDestructive (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6153:14)
    at renderIndeterminateComponent (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:5852:7)
    at renderElement (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6023:7)
    at renderNodeDestructiveImpl (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6181:11)
    at renderNodeDestructive (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6153:14)
    at renderContextProvider (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:5997:3)
    at renderElement (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6094:11)
    at renderNodeDestructiveImpl (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6181:11)
    at renderNodeDestructive (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6153:14)
    at renderIndeterminateComponent (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:5852:7)
    at renderElement (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6023:7)
    at renderNodeDestructiveImpl (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6181:11)
    at renderNodeDestructive (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6153:14)
    at renderIndeterminateComponent (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:5852:7)
    at renderElement (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6023:7)
    at renderNodeDestructiveImpl (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6181:11)
    at renderNodeDestructive (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6153:14)
    at renderIndeterminateComponent (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:5852:7)
    at renderElement (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6023:7)
    at renderNodeDestructiveImpl (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6181:11)
    at renderNodeDestructive (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6153:14)
    at renderNode (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6336:12)
    at renderChildrenArray (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6288:7)
    at renderNodeDestructiveImpl (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6218:7)
    at renderNodeDestructive (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6153:14)
    at renderContextProvider (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:5997:3)
    at renderElement (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6094:11)
    at renderNodeDestructiveImpl (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6181:11)
    at renderNodeDestructive (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6153:14)
    at renderIndeterminateComponent (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:5852:7)
    at renderElement (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6023:7)
    at renderNodeDestructiveImpl (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6181:11)
    at renderNodeDestructive (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6153:14)
    at renderNode (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6336:12)
    at renderChildrenArray (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6288:7)
    at renderNodeDestructiveImpl (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6218:7)
    at renderNodeDestructive (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6153:14)
    at renderNode (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6336:12)
    at renderHostElement (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:5708:3)
    at renderElement (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6029:5)
    at renderNodeDestructiveImpl (C:\Users\Lenovo\Documents\CERTUS VI\Exp Formativas\challenge-doctums-front-v1\node_modules\react-dom\cjs\react-dom-server.node.development.js:6181:11)
```

**Observaciones**
- En las auditorías podemos observar que en el archivo `app/routes/game+/_layout.tsx`, maneja algunos estados claves `avatarId`, `legacyModal_hasNavigated`, y `submitPlan_hasNavigated`.
- Esta ruta `_layout` al parecer es la que maneja todo lo relacionado con renderizado de modals (esto incluye el modal de crear partida y selección de personaje ?)
- useLiveLoader, hook que puede estar afectando la carga de modals.

**Modificaciones a realizar**
- Implementar mecanismos de fallback (o de respaldo).

- **Inicialización y Uso de WebSocket:** Asegurar que `globalWebSocketService` se inicialice correctamente para evitar errores al llamar a sus métodos. Manejar elegantemente los problemas de red o códigos de sesión incorrectos.
- **Gestión de Estado:** Inicializar y actualizar correctamente las variables de estado como `avatarId`, `legacyModal_hasNavigated` y `submitPlan_hasNavigated` para prevenir problemas de navegación o visualización incorrecta de modales.
- **Obtención y Manejo de Datos:** Validar las respuestas del servidor en la función `loader` para prevenir caídas. Asegurar que los datos de formulario en la función `action` sean correctos para evitar errores de procesamiento.
- **Navegación:** Verificar las condiciones para las llamadas a la función `navigate` para prevenir rutas incorrectas o errores.
- **Renderizado de Componentes:** Asegurar que componentes como `GameCanvas`, `LocalPlayerCard` y `PlayerCard` reciban las props correctas para evitar errores de renderizado.
- **Manejo de Eventos:** Gestionar correctamente los estados del juego en funciones como `triggerTurnOrderStage` y `triggerRollDices` para mantener el flujo del juego.
- **Efectos de Audio y Visuales:** Gestionar los disparadores (triggers) para componentes como `NotificationSound` para asegurar una retroalimentación de audio/visual correcta.